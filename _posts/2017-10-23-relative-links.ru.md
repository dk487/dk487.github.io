---
title: Относительные ссылки
date: 2017-10-23 15:34:19 +0300
lang: ru
---

Есть одна тема в Jekyll'е, которая меня бесит. И эта тема — ссылки.

Я глубоко убеждён, что _настоящий_ статический сайт должен использовать
относительные ссылки, причём не в том смысле, который разработчики
Jekyll'а используют в фильтре `relative_url`.

Традиционный простой пример.

```html
<link rel="stylesheet" href="...">
```

Как должна выглядеть ссылка на некий CSS?

| Исходная страница         | `relative_url`    | Правильный URL        |
|---------------------------|-------------------|-----------------------|
| /about.html               | /css/main.css     | css/main.css          |
| /contact/main-office.html | /css/main.css     | ../css/main.css       |
| /2017/10/23/example.html  | /css/main.css     | ../../../css/main.css |

Главный use case для таких ссылок — это «сайт на флешке», возможность
открыть сайт в браузере без веб-сервера из локальных файлов.

Чёрт возьми, да это же один из главных приколов статической сборки!

Также это даёт возможность хостить сайт в любом подкаталоге любого
другого сайта без пересборки с новым значением `baseurl`. Кому-то это
может показаться неважным, но только не мне. Я хочу, чтобы мой сайт
можно было без проблем открыть по какому-нибудь странному адресу вроде
`http://127.0.0.1/dk487.github.io/_site/` (совершенно _невероятный_
адрес, не так ли?)

Что можно сделать для получения таких относительных ссылок? Наверное,
можно установить какой-то плагин. Это не мой вариант по множеству причин,
хотя бы потому, что использование плагинов несовместимо с Github Pages.

Но вообще-то можно обойтись одними лишь средствами Liquid'а.

{% raw %}
```liquid
{%      assign root_prefix = ''
%}{%    assign root_subfolders = page.url | split: '/' | size | minus: 2
%}{%    for x in (1..root_subfolders)
%}{%        assign root_prefix = root_prefix | append: '../'
%}{%    endfor
%}<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="{{ root_prefix }}css/main.css">
```
{% endraw %}

Выглядит коряво, но работает.

Переменная {% raw %}`{{ root_prefix }}`{% endraw %} может пригодиться
в шаблонах, которым надо строить правильные относительные ссылки на стили,
скрипты и другие страницы.

Контент же лучше сразу писать с относительными ссылками:

```markdown
Перейти на [главную страницу](../../../index.ru.html).
```

Я надеюсь, что эти костыли [однажды перестанут быть нужными][1].
Но сейчас они здорово помогают.

[1]: https://github.com/jekyll/jekyll/issues/6360
